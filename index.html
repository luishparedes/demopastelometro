<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PASTELOMETRO - DEMO</title>
    <style>
        :root {
            --primary: #FF9AA2;
            --secondary: #FFB7B2;
            --light: #FFDAC1;
            --accent: #E2F0CB;
            --dark: #B5EAD7;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        h1, h2, h3 {
            margin-top: 0;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        button:hover {
            background-color: var(--secondary);
        }

        .btn-secondary {
            background-color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: var(--accent);
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .button-group button {
            flex: 1;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--light);
        }

        .hidden {
            display: none;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background-color: var(--light);
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background-color: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .receipt {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 20px auto;
            font-family: monospace;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px dashed #333;
            padding-bottom: 10px;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .receipt-total {
            font-weight: bold;
            border-top: 1px dashed #333;
            padding-top: 10px;
            margin-top: 10px;
        }

        .receipt-note {
            margin-top: 15px;
            font-style: italic;
            text-align: center;
            color: #666;
        }

        .demo-notice {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 5px solid #ffeeba;
        }

        .demo-limit {
            color: #dc3545;
            font-weight: bold;
        }

        .upgrade-banner {
            background: linear-gradient(135deg, #4e54c8, #8f94fb);
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
        }

        .upgrade-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }

        .upgrade-btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="business-name">PASTELOMETRO - DEMO</h1>
            <p>Calculadora inteligente para repostería</p>
        </header>
        
        <div class="demo-notice">
            <h3>¡Esta es una versión DEMO limitada!</h3>
            <p>Esta versión tiene restricciones para que pruebes las funcionalidades básicas. <span class="demo-limit">Solo puedes agregar hasta 3 ingredientes y 2 recetas.</span></p>
            <p>Para acceder a todas las funciones sin límites, adquiere la versión completa.</p>
        </div>
        
        <div class="upgrade-banner">
            <h3>¡Actualiza a la versión completa!</h3>
            <p>Desbloquea todas las funciones sin límites y lleva tu negocio de repostería al siguiente nivel.</p>
            <a href="https://forms.gle/CESXNeoQHcdyBPZu8" class="upgrade-btn">COMPRAR VERSIÓN COMPLETA</a>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="ingredients">Ingredientes</div>
            <div class="tab" data-tab="recipes">Recetas</div>
            <div class="tab" data-tab="sales">Ventas</div>
        </div>
        
        <div id="ingredients" class="tab-content active">
            <div class="card">
                <h2>Agregar Nuevo Ingrediente</h2>
                <div class="form-group">
                    <label for="ingredient-name">Nombre del Ingrediente</label>
                    <input type="text" id="ingredient-name" placeholder="Ej: Harina">
                </div>
                <div class="form-group">
                    <label for="ingredient-price">Precio ($)</label>
                    <input type="number" id="ingredient-price" step="0.01" placeholder="Ej: 1.80">
                </div>
                <div class="form-group">
                    <label for="ingredient-quantity">Cantidad</label>
                    <input type="number" id="ingredient-quantity" step="0.01" placeholder="Ej: 1000">
                </div>
                <div class="form-group">
                    <label for="ingredient-unit">Unidad de Medida</label>
                    <select id="ingredient-unit">
                        <option value="g">Gramos (g)</option>
                        <option value="kg">Kilogramos (kg)</option>
                        <option value="ml">Mililitros (ml)</option>
                        <option value="l">Litros (l)</option>
                        <option value="unidades">Unidades</option>
                    </select>
                </div>
                <button id="add-ingredient">Agregar Ingrediente</button>
                <p class="demo-limit" id="ingredient-counter">Ingredientes agregados: 0/3</p>
            </div>
            
            <div class="card">
                <h2>Lista de Ingredientes</h2>
                <table id="ingredients-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Cantidad</th>
                            <th>Precio por unidad</th>
                        </tr>
                    </thead>
                    <tbody id="ingredients-list">
                        <!-- Aquí se cargarán los ingredientes -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="recipes" class="tab-content">
            <div class="card">
                <h2>Agregar Nueva Receta</h2>
                <div class="form-group">
                    <label for="recipe-name">Nombre de la Receta</label>
                    <input type="text" id="recipe-name" placeholder="Ej: Pastel de Piña">
                </div>
                
                <div id="recipe-ingredients">
                    <h3>Ingredientes</h3>
                    <div class="ingredient-row">
                        <div class="form-group">
                            <label>Ingrediente</label>
                            <select class="recipe-ingredient">
                                <option value="">Seleccionar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Cantidad</label>
                            <input type="number" class="recipe-quantity" step="0.01">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="recipe-portions">Porciones (unidades)</label>
                    <input type="number" id="recipe-portions" value="1">
                </div>
                
                <div class="form-group">
                    <label for="recipe-profit">Porcentaje de ganancia (%)</label>
                    <input type="number" id="recipe-profit" value="30">
                </div>
                
                <button id="save-recipe">Guardar Receta</button>
                <p class="demo-limit" id="recipe-counter">Recetas agregadas: 0/2</p>
            </div>
            
            <div class="card">
                <h2>Mis Recetas</h2>
                <table id="recipes-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Costo Total</th>
                            <th>Precio de Venta</th>
                            <th>Porciones</th>
                            <th>Precio por Porción</th>
                        </tr>
                    </thead>
                    <tbody id="recipes-list">
                        <!-- Aquí se cargarán las recetas -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="sales" class="tab-content">
            <div class="card">
                <h2>Generar Venta</h2>
                <div class="form-group">
                    <label for="sale-recipe">Seleccionar Receta</label>
                    <select id="sale-recipe">
                        <option value="">Seleccionar receta</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="sale-type">Tipo de Venta</label>
                    <select id="sale-type">
                        <option value="whole">Pastel completo</option>
                        <option value="portion">Por porción</option>
                    </select>
                </div>
                
                <div class="form-group" id="portion-quantity-container">
                    <label for="portion-quantity">Cantidad de porciones</label>
                    <input type="number" id="portion-quantity" value="1" min="1">
                </div>
                
                <div class="form-group">
                    <label for="exchange-rate">Tasa de cambio ($ a Bs)</label>
                    <input type="number" id="exchange-rate" step="0.01" value="77.00">
                </div>
                
                <button id="generate-sale">Generar Venta</button>
                
                <div id="receipt-container" class="hidden">
                    <div class="receipt" id="receipt">
                        <div class="receipt-header">
                            <h2 id="receipt-business-name">PASTELOMETRO - DEMO</h2>
                            <p id="receipt-type">Recibo de Venta</p>
                        </div>
                        <div id="receipt-content">
                            <!-- Contenido del recibo -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Reporte de Ventas</h2>
                <table id="sales-report">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Receta</th>
                            <th>Tipo</th>
                            <th>Cantidad</th>
                            <th>Total ($)</th>
                            <th>Total (Bs)</th>
                        </tr>
                    </thead>
                    <tbody id="sales-list">
                        <!-- Aquí se cargarán las ventas -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables globales con límites de demo
            let ingredients = JSON.parse(localStorage.getItem('ingredients')) || [];
            let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
            let sales = JSON.parse(localStorage.getItem('sales')) || [];
            const MAX_INGREDIENTS = 3;
            const MAX_RECIPES = 2;
            
            // Elementos del DOM
            const businessNameElement = document.getElementById('business-name');
            const receiptBusinessName = document.getElementById('receipt-business-name');
            const ingredientCounter = document.getElementById('ingredient-counter');
            const recipeCounter = document.getElementById('recipe-counter');
            
            // Inicializar la aplicación
            init();
            
            // Funciones de inicialización
            function init() {
                updateCounters();
                loadIngredients();
                loadRecipes();
                loadSales();
                setupEventListeners();
                updateIngredientDropdowns();
            }
            
            function updateCounters() {
                ingredientCounter.textContent = `Ingredientes agregados: ${ingredients.length}/${MAX_INGREDIENTS}`;
                recipeCounter.textContent = `Recetas agregadas: ${recipes.length}/${MAX_RECIPES}`;
            }
            
            function setupEventListeners() {
                // Tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        this.classList.add('active');
                        document.getElementById(this.dataset.tab).classList.add('active');
                    });
                });
                
                // Ingredientes
                document.getElementById('add-ingredient').addEventListener('click', addIngredient);
                
                // Recetas
                document.getElementById('save-recipe').addEventListener('click', saveRecipe);
                
                // Ventas
                document.getElementById('generate-sale').addEventListener('click', generateSale);
                
                // Tipo de venta
                document.getElementById('sale-type').addEventListener('change', function() {
                    document.getElementById('portion-quantity-container').style.display = 
                        this.value === 'portion' ? 'block' : 'none';
                });
            }
            
            // Funciones de ingredientes
            function addIngredient() {
                if (ingredients.length >= MAX_INGREDIENTS) {
                    alert(`Versión DEMO limitada: Solo puedes agregar hasta ${MAX_INGREDIENTS} ingredientes.`);
                    return;
                }
                
                const name = document.getElementById('ingredient-name').value.trim();
                const price = parseFloat(document.getElementById('ingredient-price').value);
                const quantity = parseFloat(document.getElementById('ingredient-quantity').value);
                const unit = document.getElementById('ingredient-unit').value;
                
                if (!name || isNaN(price) || isNaN(quantity)) {
                    alert('Por favor complete todos los campos correctamente');
                    return;
                }
                
                const unitPrice = price / quantity;
                
                const ingredient = {
                    id: Date.now(),
                    name,
                    price,
                    quantity,
                    unit,
                    unitPrice
                };
                
                ingredients.push(ingredient);
                saveIngredients();
                
                // Limpiar formulario
                document.getElementById('ingredient-name').value = '';
                document.getElementById('ingredient-price').value = '';
                document.getElementById('ingredient-quantity').value = '';
                
                loadIngredients();
                updateIngredientDropdowns();
                updateCounters();
            }
            
            function loadIngredients() {
                const tbody = document.getElementById('ingredients-list');
                tbody.innerHTML = '';
                
                if (ingredients.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4">No hay ingredientes registrados</td></tr>';
                    return;
                }
                
                ingredients.forEach(ingredient => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${ingredient.name}</td>
                        <td>$${ingredient.price.toFixed(2)}</td>
                        <td>${ingredient.quantity} ${ingredient.unit}</td>
                        <td>$${ingredient.unitPrice.toFixed(6)}/${ingredient.unit}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            function updateIngredientDropdowns() {
                const dropdowns = document.querySelectorAll('.recipe-ingredient, #sale-recipe');
                
                dropdowns.forEach(dropdown => {
                    const currentValue = dropdown.value;
                    dropdown.innerHTML = dropdown.id === 'sale-recipe' 
                        ? '<option value="">Seleccionar receta</option>'
                        : '<option value="">Seleccionar</option>';
                    
                    if (dropdown.id === 'sale-recipe') {
                        recipes.forEach(recipe => {
                            const option = document.createElement('option');
                            option.value = recipe.id;
                            option.textContent = recipe.name;
                            dropdown.appendChild(option);
                        });
                    } else {
                        ingredients.forEach(ingredient => {
                            const option = document.createElement('option');
                            option.value = ingredient.id;
                            option.textContent = `${ingredient.name} ($${ingredient.unitPrice.toFixed(6)}/${ingredient.unit})`;
                            dropdown.appendChild(option);
                        });
                    }
                    
                    // Restaurar el valor seleccionado si existe
                    if (currentValue && Array.from(dropdown.options).some(opt => opt.value === currentValue)) {
                        dropdown.value = currentValue;
                    }
                });
            }
            
            function saveIngredients() {
                localStorage.setItem('ingredients', JSON.stringify(ingredients));
            }
            
            // Funciones de recetas
            function saveRecipe() {
                if (recipes.length >= MAX_RECIPES) {
                    alert(`Versión DEMO limitada: Solo puedes agregar hasta ${MAX_RECIPES} recetas.`);
                    return;
                }
                
                const name = document.getElementById('recipe-name').value.trim();
                const portions = parseInt(document.getElementById('recipe-portions').value);
                const profit = parseFloat(document.getElementById('recipe-profit').value);
                
                if (!name || isNaN(portions) || isNaN(profit)) {
                    alert('Por favor complete todos los campos correctamente');
                    return;
                }
                
                // Obtener ingredientes de la receta
                const ingredientSelects = document.querySelectorAll('.recipe-ingredient');
                const quantityInputs = document.querySelectorAll('.recipe-quantity');
                const recipeIngredients = [];
                let totalCost = 0;
                
                for (let i = 0; i < ingredientSelects.length; i++) {
                    const ingredientId = parseInt(ingredientSelects[i].value);
                    const quantity = parseFloat(quantityInputs[i].value);
                    
                    if (ingredientId && !isNaN(quantity)) {
                        const ingredient = ingredients.find(i => i.id === ingredientId);
                        if (ingredient) {
                            const cost = quantity * ingredient.unitPrice;
                            totalCost += cost;
                            
                            recipeIngredients.push({
                                ingredientId,
                                name: ingredient.name,
                                quantity,
                                unit: ingredient.unit,
                                cost
                            });
                        }
                    }
                }
                
                if (recipeIngredients.length === 0) {
                    alert('Debe agregar al menos un ingrediente a la receta');
                    return;
                }
                
                // En la demo simplificamos los cálculos
                const salePrice = totalCost * (1 + (profit / 100));
                const portionPrice = salePrice / portions;
                
                const recipe = {
                    id: Date.now(),
                    name,
                    portions,
                    profit,
                    ingredients: recipeIngredients,
                    totalCost,
                    salePrice,
                    portionPrice,
                    createdAt: new Date().toISOString()
                };
                
                recipes.push(recipe);
                saveRecipes();
                
                // Limpiar formulario
                document.getElementById('recipe-name').value = '';
                document.getElementById('recipe-portions').value = '1';
                document.getElementById('recipe-profit').value = '30';
                
                const ingredientsContainer = document.getElementById('recipe-ingredients');
                ingredientsContainer.innerHTML = `
                    <h3>Ingredientes</h3>
                    <div class="ingredient-row">
                        <div class="form-group">
                            <label>Ingrediente</label>
                            <select class="recipe-ingredient">
                                <option value="">Seleccionar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Cantidad</label>
                            <input type="number" class="recipe-quantity" step="0.01">
                        </div>
                    </div>
                `;
                
                loadRecipes();
                updateIngredientDropdowns();
                updateCounters();
            }
            
            function loadRecipes() {
                const tbody = document.getElementById('recipes-list');
                tbody.innerHTML = '';
                
                if (recipes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5">No hay recetas registradas</td></tr>';
                    return;
                }
                
                recipes.forEach(recipe => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${recipe.name}</td>
                        <td>$${recipe.totalCost.toFixed(2)}</td>
                        <td>$${recipe.salePrice.toFixed(2)}</td>
                        <td>${recipe.portions}</td>
                        <td>$${recipe.portionPrice.toFixed(2)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            function saveRecipes() {
                localStorage.setItem('recipes', JSON.stringify(recipes));
            }
            
            // Funciones de ventas
            function generateSale() {
                const recipeId = parseInt(document.getElementById('sale-recipe').value);
                const saleType = document.getElementById('sale-type').value;
                const portionQuantity = parseInt(document.getElementById('portion-quantity').value) || 1;
                const exchangeRate = parseFloat(document.getElementById('exchange-rate').value) || 77.00;
                
                if (!recipeId) {
                    alert('Por favor seleccione una receta');
                    return;
                }
                
                const recipe = recipes.find(r => r.id === recipeId);
                if (!recipe) return;
                
                let total, quantityText;
                
                if (saleType === 'portion') {
                    total = recipe.portionPrice * portionQuantity;
                    quantityText = `${portionQuantity} porción(es)`;
                } else {
                    total = recipe.salePrice;
                    quantityText = '1 pastel completo';
                }
                
                const totalBs = total * exchangeRate;
                
                const sale = {
                    id: Date.now(),
                    recipeId,
                    recipeName: recipe.name,
                    saleType,
                    quantity: saleType === 'portion' ? portionQuantity : 1,
                    total,
                    totalBs,
                    exchangeRate,
                    date: new Date().toISOString()
                };
                
                sales.push(sale);
                saveSales();
                loadSales();
                
                // Generar recibo
                generateReceipt(sale, recipe);
                
                // Mostrar recibo
                document.getElementById('receipt-container').classList.remove('hidden');
            }
            
            function generateReceipt(sale, recipe) {
                const receiptContent = document.getElementById('receipt-content');
                
                let html = `
                    <div class="receipt-item">
                        <span>Receta:</span>
                        <span>${recipe.name}</span>
                    </div>
                    <div class="receipt-item">
                        <span>Tipo:</span>
                        <span>${sale.saleType === 'portion' ? 'Por porción' : 'Pastel completo'}</span>
                    </div>
                    <div class="receipt-item">
                        <span>Cantidad:</span>
                        <span>${sale.saleType === 'portion' ? sale.quantity + ' porción(es)' : '1 unidad'}</span>
                    </div>
                    <div class="receipt-item">
                        <span>Fecha:</span>
                        <span>${new Date().toLocaleString()}</span>
                    </div>
                    <div class="receipt-item receipt-total">
                        <span>Total ($):</span>
                        <span>$${sale.total.toFixed(2)}</span>
                    </div>
                    <div class="receipt-item">
                        <span>Total (Bs):</span>
                        <span>${sale.totalBs.toFixed(2)} Bs</span>
                    </div>
                    <div class="receipt-item">
                        <span>Tasa de cambio:</span>
                        <span>1$ = ${sale.exchangeRate.toFixed(2)} Bs</span>
                    </div>
                    <div class="receipt-note">
                        <p><em>Este es un DEMO de Pastelómetro. Los datos se guardan solo en tu navegador.</em></p>
                    </div>
                `;
                
                receiptContent.innerHTML = html;
            }
            
            function loadSales() {
                const tbody = document.getElementById('sales-list');
                tbody.innerHTML = '';
                
                if (sales.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6">No hay ventas registradas</td></tr>';
                    return;
                }
                
                // Calcular totales
                let totalSales = 0;
                let totalSalesBs = 0;
                
                sales.forEach(sale => {
                    const date = new Date(sale.date);
                    const formattedDate = date.toLocaleDateString();
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td>${sale.recipeName}</td>
                        <td>${sale.saleType === 'portion' ? 'Porción' : 'Completo'}</td>
                        <td>${sale.quantity}</td>
                        <td>$${sale.total.toFixed(2)}</td>
                        <td>${sale.totalBs.toFixed(2)} Bs</td>
                    `;
                    tbody.appendChild(row);
                    
                    totalSales += sale.total;
                    totalSalesBs += sale.totalBs;
                });
                
                // Agregar fila de totales
                const totalsRow = document.createElement('tr');
                totalsRow.style.fontWeight = 'bold';
                totalsRow.innerHTML = `
                    <td colspan="4">TOTALES</td>
                    <td>$${totalSales.toFixed(2)}</td>
                    <td>${totalSalesBs.toFixed(2)} Bs</td>
                `;
                tbody.appendChild(totalsRow);
            }
            
            function saveSales() {
                localStorage.setItem('sales', JSON.stringify(sales));
            }
        });
    </script>
</body>
</html>
